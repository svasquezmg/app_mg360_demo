
@{
    ViewBag.Title = "CotizacionList";
    int anio = DateTime.Now.Year;
    int veces = 1;
}

<link rel="stylesheet" href="~/assets/descargados/dataTables.bootstrap5.min.css">
<link rel="stylesheet" href="~/assets/descargados/responsive.bootstrap.min.css">
<link rel="stylesheet" href="~/assets/descargados/buttons.bootstrap5.min.css">
<!--<link href="~/assets/descargados/select2.min.css" rel="stylesheet">-->
<!--<link rel="stylesheet" href="~/assets/libs/flatpickr/flatpickr.min.css">-->
<!-- Start:: row-2 -->
<div class="row">
    <div class="col-xl-12">
        <div class="card custom-card">
            <div class="card custom-card">
                <div class="card-header fs-18 fw-semibold mb-0 text-primary">
                    Mis Cotizaciones
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-xl-2">
                            <label for="CboAnio" class="form-label">Año</label>
                            <select id="CboAnio" class="form-select form-control-sm mb-2">
                                <option value="@anio">@anio</option>
                                @{ while (veces < 3)
                                    {
                                        anio = anio - 1;
                                        <option value="@anio">@anio</option>
                                        veces++;
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-xl-2">
                            <label for="CboMes" class="form-label">Mes</label>
                            <select id="CboMes" class="form-select form-control-sm mb-2">
                                <option value="01">Enero</option>
                                <option value="02">Febrero</option>
                                <option value="03">Marzo</option>
                                <option value="04">Abril</option>
                                <option value="05">Mayo</option>
                                <option value="06">Junio</option>
                                <option value="07">Julio</option>
                                <option value="08">Agosto</option>
                                <option value="09">Setiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                        </div>
                        <div class="col-xl-3">
                            <label for="VendedorCbo" class="form-label">Vendedor</label>
                            <select class="form-select form-control-sm mb-2" id="VendedorCbo">
                                @{
                                    var usu_data = ViewData["Usuario"] as WebAppMontGroup.Entity.Usuario;
                                    <option value="@usu_data.codigovendedor" RValamcen="@usu_data.codigoalmacen">
                                        @usu_data.nombres -
                                        @usu_data.codigovendedor
                                    </option>

                                    foreach (var usu in ViewData["VendedorAsociado"] as
                                    IList<WebAppMontGroup.Entity.Usuario>)
                                    {
                                        <option value="@usu.codigovendedor" RValamcen="@usu.codigoalmacen">
                                            @usu.nombres -
                                            @usu.codigovendedor
                                        </option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-xl-2" style="margin-bottom: 10px;">
                            <label for="divButton" class="form-label">&nbsp;</label>
                            <div id="divButton">
                                <button type="button" class="btn btn-primary btpsecMg" data-bs-toggle="modal" id="btnBuscarPedido" data-bs-target="#exampleModalScrollable3">Buscar Cotizaciones</button>
                            </div>
                        </div>
                        <div class="col-xl-2" style="margin-bottom: 10px;">
                            <label for="divButton" class="form-label">&nbsp;</label>
                            <div id="divButton">
                                <a href="../Pedido/CotizacionCrear" class="btn btn-primary btn-wave waves-effect waves-light" style="width:100%">Nueva Cotización</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body" style="padding-top:0px">
                <div class="table-responsive">
                    <table id="responsiveDataTable2" class="table table-bordered text-nowrap w-100">
                        <thead>
                            <tr>
                                <th class="thMG1">Cotizacion</th>
                                <th class="thMG1">Coa</th>
                                <th class="thMG1">Cliente</th>
                                <th class="thMG1">Cod Vendedor</th>
                                <th class="thMG1">Contacto</th>
                                <th class="thMG1">Total</th>
                                <th class="thMG1">Registrado</th>
                                <th class="thMG1">Creado Por</th>
                                <th class="thMG1">Ver</th>
                                <th class="thMG1">Descargar</th>
                                <th class="thMG1">ID</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                                <td>xx</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End:: row-2 -->


<div class="modal fade" id="exampleModalScrollableCotizacionLst" tabindex="-1" data-bs-backdrop="static"
     aria-labelledby="exampleModalScrollableCotizacionLst" data-bs-keyboard="false"
     aria-hidden="true">
    <!-- Scrollable modal -->
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <!--<div class="modal-header">
                <h6 class="modal-title" id="staticBackdropLabel2">
                    Modal title
                </h6>
            </div>-->
            <div class="modal-body" style="text-align:center">
                <img src="~/assets/images/loading.gif" />
                <p>
                    Estamos cargando la información. Por favor, espere.
                </p>
            </div>
        </div>
    </div>
</div>




<script src="~/assets/descargados/jquery.dataTables.min.js"></script>
<script src="~/assets/descargados/dataTables.bootstrap5.min.js"></script>
<script src="~/assets/descargados/dataTables.responsive.min.js"></script>
<script src="~/assets/descargados/dataTables.buttons.min.js"></script>
@*<script src="~/assets/descargados/buttons.print.min.js"></script>*@
@*<script src="~/assets/descargados/pdfmake.min.js"></script>*@
@*<script src="~/assets/descargados/vfs_fonts.js"></script>*@
<script src="~/assets/descargados/buttons.html5.min.js"></script>
<script src="~/assets/descargados/jszip.min.js"></script>


<!--<script src="~/assets/js/Toasts.js"></script>-->
<!-- Select2 Cdn -->
<!--<script src="~/assets/descargados/select2.min.js"></script>-->
<!-- Internal Select-2.js -->
<!--<script src="~/assets/js/select2.js"></script>-->
<!-- Internal Datatables JS -->
<script src="~/assets/js/datatables.js"></script>


<!-- Date & Time Picker JS -->
<!--<script src="~/assets/libs/flatpickr/flatpickr.min.js"></script>-->
<!--<script src="~/assets/js/date&time_pickers.js"></script>-->

<script src="~/assets/js/jsMG.js"></script>

<script type="text/javascript">

    var saldo_inicial = 0;

    $(document).ready(function () {
        $("#CboMes").val("@DateTime.Now.ToString("MM")")
        fnConsularCotizacion();
    });



    $("#btnBuscarPedido").click(function () {
        fnConsularCotizacion();
    });



    async function fnConsularCotizacion() {

        $('#exampleModalScrollableCotizacionLst').modal('show');
        var table = new DataTable('#responsiveDataTable2');
        var rows = table
            .rows()
            .remove()
            .draw();

        var _css = "";

        $.ajax({
            url: '../Pedido/lstCotizacion',
            type: 'GET',
            data: {
                anio: $("#CboAnio").val(),
                mes: $("#CboMes").val(),
                codVendedor: $("#VendedorCbo").val()
            },
            success: async function (response) {
                //debugger;
                //console.log(response);
                if (response == "-1") {
                    //document.location.href = "/MG360";
                }
                $.each(response, function (key, value) {


                 let fechaModificacion = value.FechaModificacion ? $.formattedDateyyyyMMdd(new Date(parseInt(value.FechaRegistro.substr(6)))) : "";

                    //$('#responsiveDataTable2').DataTable().row.add($('<tr><td class="' + _css + '">' + value.CodCotizacion + '</td>' +
                    $('#responsiveDataTable2').DataTable().row.add($("<tr><td><span class='text-primary fw-semibold'>" + value.CodCotizacion + "</span></td>" +
                        '<td>' + value.Coa + '</td>' +
                        '<td>' + value.Cliente + '</td>' +
                        '<td>' + value.CodVendedor + '</td>' +
                        '<td>' + value.Contacto + '</td>' +
                        '<td>' + value.Total + '</td>' +
                        '<td>' + $.formattedDateyyyyMMdd(new Date(parseInt(value.FechaRegistro.substr(6)))) + '</td>' +
                        '<td>' + value.UsuarioCreador + '</td>' +
                        "<td><a href='../Pedido/CotizacionCrear?id=" + value.Id + "' target='_blank'' class='text-primary fw-semibold'>Ver</a></td>" +
                        "<td><a href='../Pedido/CotizacionDescargar?id=" + value.Id + "' target='_blank'' class='text-primary fw-semibold'>Descargar</a></td>" +
                        '<td>' + value.Id + '</td></tr>')).draw();

                });

                setTimeout(function () {
                    $('#responsiveDataTable2').DataTable().order([10, 'desc']).draw();
                    $("#exampleModalScrollableCotizacionLst").modal('hide');
                }, 500);

            },
            error: function (xhr, status, error) {
                console.error(error);
            }
        });
    }




</script>

<style>

    .btpsecMg {
        width: 100%;
        color: #ffffff !important;
        background: #7f8c8d !important;
        border: #7f8c8d;
    }

    .choices {
        margin-bottom: 15px !important;
    }

    .divFecha {
        margin-top: 0px !important;
    }

    .tdCendter {
        text-align: center !important;
    }

    .rowRed {
        background-color: rgba(var(--danger-rgb), .1) !important;
        color: rgb(var(--danger-rgb)) !important;
        border-color: rgba(var(--danger-rgb), .1) !important;
    }

    .dtr-details {
        width: 100%
    }

    .cssPendiente {
        color: #d4ac0d !important; /*#fff3cd*/
        font-weight: bold;
    }

    .cssFinalizado {
        color: #45b39d !important; /*#d5f5e3*/
        font-weight: bold;
    }

    .cssDesaprobado {
        color: #c0392b !important; /*#f5b7b1*/
        font-weight: bold;
    }

    .btplstDoc {
        font-size: 12px;
    }
</style>

<!--<link href="~/assets/css/cssMG.css" rel="stylesheet" />-->
@{
    var usu_data3 = Session["SessionUsuario"] as WebAppMontGroup.Entity.Usuario;
    if (usu_data3.estiloWeb == "Estilo2")
    {
        <link href="~/assets/css/cssMG2.css" rel="stylesheet" />
    }
}